## 缓存
```
1.什么是缓存
2.为什么使用缓存
3.缓存架构
4.应用程序(后端)缓存优势和劣势
5.应用程序(后端)缓存问题
6.应用程序(后端)缓存更新策略
7.应用程序(后端)缓存设计原则
8.参考资料
```

### 1.什么是缓存
```
缓存是一个高速数据存储层,其中存储了数据子集,且通常是短暂性存储,这样以后再次或者多次请求该数据时,
速度要比访问数据的真实存储位置快.通过缓存,您可以高效地重用之前检索或计算的数据
缓存是临时存放数据(使用频繁的数据)的地方,介于外部请求和真实数据之间
```

### 2.为什么使用缓存
```
缓存可以减少用户等待时间,提升用户体验
```

### 3.缓存架构
```

```

### 4.应用程序(后端)缓存优势和劣势

```
优势:
  1.提升应用程序性能
  2.提高吞吐量
  3.降低数据库压力

劣势:
  1.可能出现数据不一致
  2.增加系统的复杂度(但换来性能的提升)
```


### 5.应用程序(后端)缓存问题
```
1.缓存穿透
  什么是缓存穿透: 
    缓存穿透指的是使用不存在的key进行大量的高并发查询,这导致缓存无法命中.
    每次请求都要穿透到后端数据库系统进行查询,这也是经常提的缓存命中率问题
    
  缓存穿透的原因:
    2.由于请求的参数是不合法的 (每次都请求不存在的参数)
    3.由于从数据库找不到数据的时候
    4.程序bug
    
  如何解决:
    1.一般采用布隆过滤器,将所有可能存在的数据哈希到一个足够大的bitmap中,一个一定不存在的数据会被这个bitmap拦截掉,
    从而避免了对底层存储系统的查询压力

    
  
2.缓存雪崩:
  什么是缓存雪崩:
    大量缓存集中在某一个时间段失效,所有请求都去查询数据库,造成瞬时DB请求量大、压力骤增引起雪崩.
    从而形成一系列连锁反应,造成整个系统崩溃
    
  造成缓存雪崩原因:
    大量的key在同一时间失效
  
  如何解决:
  	1.缓存服务器的缓存数据持久化,重启后自动从磁盘上加载数据,快速恢复缓存数据
  	2.缓存服务器高可用(主从架构)尽量避免缓存服务器挂掉这种情况发生
  	3.万一缓存服务器真的挂了,我们可以设置本地缓存 + 限流,尽量避免我们的数据库被干掉(起码能保证我们的服务还是能正常工作的)
  	4.万一缓存服务器真的挂了,缓存预热,然后将灌入了热数据的redis对外提供服务
      这样就不至于冷启动,直接让数据库裸奔
    5.在缓存的时候给过期时间加上一个随机值,这样就会大幅度的减少缓存在同一时间过期
  
  
  
3.缓存数据一致性问题:
  1.先写缓存,再写数据库
    假如缓存写成功,但写数据库失败或响应延迟,则下次读取(并发读)缓存时,就出现脏读
    
  2.先写数据库,再写缓存
    假如写数据库成功,但写缓存失败,则下次读取(并发读)缓存时,则读不到数据
    
  3.缓存异步刷新
    指数据库操作和写缓存不在一个操作步骤中
    比如在分布式场景下,无法做到同时写缓存或需要异步刷新(补救措施)时候
    缓存异步刷新主要有2中方式常驻任务定时处理、消息队列处理
```


### 6.应用程序(后端)缓存更新策略
```
被动失效:
  描述:
    一般来说业务可以容忍一段时间内数据不一致,那么我们可以对一个数据设置一定时间的过期时间,
    在数据过期后,再从真实数据源获取数据,重新放到缓存中,继续设置过期时间
  
  优势:
    用户的维护成本不是很高,只需要设置expire过期时间即可
  劣势:
    你的业务允许这段时间可能发生的数据不一致

主动更新:
  描述:
    业务对于数据的一致性要求很高.需要在真实数据更新后,立即更新缓存数据
    
  优势:
    一致性最高(几乎接近强一致)
  劣势:
    维护成本相当高,用户需要自己来完成更新(需要一定量的代码,从某种程度上加大了系统的复杂性),需要自己检查数据是否真的更新的工作
    如果主动更新发生了问题,那么这条数据很可能很长时间不会更新了,这时候你需要额外的机制保证缓存数据更新成功
```

### 7.应用程序(后端)缓存设计原则
```
1.应该将热(读频繁)数据放到缓存中
2.所有缓存信息都应设置过期时间
3.缓存过期时间应当分散以避免集中过期
4.缓存key应具备可读性,也可以对key进行适当的缩写以节省内存空间
5.选择合适的数据类型
```

### 8.参考资料
- [高并发系统缓存设计](https://younghz.github.io/高并发系统缓存设计)
- [大型分布式网站架构](https://juejin.im/post/5ae338ac6fb9a07ab4585b92)
- [在面试前必须要知道的 Redis 面试内容](https://learnku.com/articles/22363)
- [什么是缓存雪崩和缓存穿透](https://www.ydstudio.net/archives/49.html)
- [大型分布式网站架构：缓存在分布式系统中的应用](https://juejin.im/post/5ae338ac6fb9a07ab4585b92)
- [缓存常用更新策略对比(一致性)](https://blog.csdn.net/dhfzhishi/article/details/82960014)
